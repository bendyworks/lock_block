#!/usr/bin/env ruby
require 'digest/sha1'
require 'ripper'

input = ARGF.read
begin
  # ignoring purely whitespace tokens
  tokens = Ripper.tokenize(input).select { |t| t.gsub(/\s+/, "") != '' }
  hash   = Digest::SHA1.hexdigest tokens.to_s
  puts "# lock do  #{hash}"
  puts input
  puts "# lock end #{hash}"
rescue SyntaxError
  puts input
  exit 1
end
